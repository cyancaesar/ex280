OpenShift cluster areas for troubleshooting:
- OpenShift operators
- OpenShift nodes
- Version mismatch

Verify node health:
- `oc get nodes`
- `oc adm top nodes`
- `oc describe node`
	- Events
	- Allocated resources
	- Capacity
	- Non-terminated Pods

Monitoring operators:
- Operators are the programs that are responsible for starting the different components running in the cluster
- These components are started by operators as Daemonsets or Deployments
- `oc get clusteroperators`

Analyze operators:
- ClusterOperator resources are non-namespaced
- Each operator starts its resources in dedicated namespace

Verify cluster version:
- `oc get clusterversion`
- `oc describe clusterversion`
- `oc version`

Node logs:
- `oc adm node-logs nodename` logs generated by a CoreOS node
- `oc adm node-logs -u crio nodename` logs generated by the CRI-o service
- `oc adm node-logs -u kubelet nodename` logs generated by the kubelet service

Open a shell on a node:
- `oc debug node/nodename`
	- `chroot /host`
	- `systemctl status kubelet` or `crio`
	- `crictl ps`

Controlling the number of cluster workers:
- Manual and automatic cluster scaling works through Machine API
- Installing an additional worker node is not considered scaling
- Machine API is a standard component that runs as an operator
- This operator provides controllers that interacts with cluster resources
- In automated environment, it communicates with the provider to take care of cluster scaling

Machine API custom resources:
- Machines are the compute units in the cluster
- MachineSets describe group of machines, but not control plane nodes
	- MachineSets are to machines what replica sets are to Pods
	- Includes labels that allow you to work with regions, zones, and instance types
	- When deployed to public cloud, you mostly get one machine set per availability zone
- MachineHealthChecks verify the health of a machine

Two way of manual scaling machines:
- `oc scale`
- Change the number of replicas in the machine set resource

Automatic scaling in full-stack automation requires two custom resources:
- MachineAutoScaler
- ClusterAutoScaler

The Machine API operator must be operational in order to configure any type of scaling. While the machine autoscaler automatically scales the number of replicas based on load.

The cluster autoscaler enforces limits for the entire cluster
- MaxNodesTotal: sets maximum nodes
- MaxMemoryTotal: sets maximum memory

Implementing AutoScaler:
- The cluster is deployed in full-stack automation
- There is a cluster autoscaler resource
	- Set scaleDown to `enabled: true` to allow for downscaling as well
- At least one machine autoscaler resource exists

#### Updating the Cluster

- OpenShift 4.x offers *Over-the-Air* (OTA) upgrades
- The OTA software distribution system manages controller manifests, cluster roles and other resources necessary to update a cluster
- OTA is offered as a service on https://cloud.redhat.com
- OTA requires the cluster to have a persistent connection to the Internet

How OTA works:
- Prometheus based telemetry is used to determine the update path
- Supported operators can be automatically updated
- Future versions will include Independent Software Vendor (ISV) operators to be updated in this way as well
- From the cloud.redhat.com interface, an update channel can be selected to determine the version of OpenShift to update to
- No support is offered to do rollback

OTA flow:
- All operators need to be updated to the newer version
- CoreOS images can be updated
	- The node pulls the new image
	- Image is written to disk
	- The bootloader is changed to boot the new image
	- CoreOS machine reboots

Manually update the cluster:
- `oc get clusterversion` shows the current version
- `oc adm upgrade` shows if an upgrade is available
- `oc adm upgrade --to-latest=true` upgrade to the latest version
- `oc adm upgrade --to=version` upgrade to specific version
- `oc get clusteroperators`
- `oc describe clusterversion`